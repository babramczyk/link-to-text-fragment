(()=>{"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var L=["ADDRESS","ARTICLE","ASIDE","BLOCKQUOTE","BR","DETAILS","DIALOG","DD","DIV","DL","DT","FIELDSET","FIGCAPTION","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","LI","MAIN","NAV","OL","P","PRE","SECTION","TABLE","UL","TR","TH","TD","COLGROUP","COL","CAPTION","THEAD","TBODY","TFOOT"],C=/[\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,j=/[^\t-\r -#%-\*,-\/:;\?@\[-\]_\{\}\x85\xA0\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u1680\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2000-\u200A\u2010-\u2029\u202F-\u2043\u2045-\u2051\u2053-\u205F\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E44\u3000-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]|\uD800[\uDD00-\uDD02\uDF9F\uDFD0]|\uD801\uDD6F|\uD802[\uDC57\uDD1F\uDD3F\uDE50-\uDE58\uDE7F\uDEF0-\uDEF6\uDF39-\uDF3F\uDF99-\uDF9C]|\uD804[\uDC47-\uDC4D\uDCBB\uDCBC\uDCBE-\uDCC1\uDD40-\uDD43\uDD74\uDD75\uDDC5-\uDDC9\uDDCD\uDDDB\uDDDD-\uDDDF\uDE38-\uDE3D\uDEA9]|\uD805[\uDC4B-\uDC4F\uDC5B\uDC5D\uDCC6\uDDC1-\uDDD7\uDE41-\uDE43\uDE60-\uDE6C\uDF3C-\uDF3E]|\uD807[\uDC41-\uDC45\uDC70\uDC71]|\uD809[\uDC70-\uDC74]|\uD81A[\uDE6E\uDE6F\uDEF5\uDF37-\uDF3B\uDF44]|\uD82F\uDC9F|\uD836[\uDE87-\uDE8B]|\uD83A[\uDD5E\uDD5F]/u,J=e=>{let n=[],t=document.createRange();for(t.selectNodeContents(document.body);!t.collapsed&&n.length<2;){let u;if(e.prefix){let r=g(e.prefix,t);if(r==null)break;O(t,r.startContainer,r.startOffset);let s=document.createRange();if(s.setStart(r.endContainer,r.endOffset),s.setEnd(t.endContainer,t.endOffset),H(s),s.collapsed||(u=g(e.textStart,s),u==null))break;if(u.compareBoundaryPoints(Range.START_TO_START,s)!==0)continue}else{if(u=g(e.textStart,t),u==null)break;O(t,u.startContainer,u.startOffset)}if(e.textEnd){let r=document.createRange();for(r.setStart(u.endContainer,u.endOffset),r.setEnd(t.endContainer,t.endOffset);!r.collapsed&&n.length<2;){let s=g(e.textEnd,r);if(s==null)break;if(O(r,s.startContainer,s.startOffset),u.setEnd(s.endContainer,s.endOffset),e.suffix){let i=y(e.suffix,u,t);if(i===F.NO_SUFFIX_MATCH)break;if(i===F.SUFFIX_MATCH){n.push(u.cloneRange());continue}else if(i===F.MISPLACED_SUFFIX)continue}else n.push(u.cloneRange())}}else if(e.suffix){let r=y(e.suffix,u,t);if(r===F.NO_SUFFIX_MATCH)break;if(r===F.SUFFIX_MATCH){n.push(u.cloneRange()),O(t,t.startContainer,t.startOffset);continue}else if(r===F.MISPLACED_SUFFIX)continue}else n.push(u.cloneRange())}return n},F={NO_SUFFIX_MATCH:0,SUFFIX_MATCH:1,MISPLACED_SUFFIX:2},y=(e,n,t)=>{let u=document.createRange();u.setStart(n.endContainer,n.endOffset),u.setEnd(t.endContainer,t.endOffset),H(u);let r=g(e,u);return r==null?F.NO_SUFFIX_MATCH:r.compareBoundaryPoints(Range.START_TO_START,u)!==0?F.MISPLACED_SUFFIX:F.SUFFIX_MATCH},O=(e,n,t)=>{try{e.setStart(n,t+1)}catch(u){e.setStartAfter(n)}},H=e=>{let n=document.createTreeWalker(e.commonAncestorContainer,NodeFilter.SHOW_TEXT,u=>_(u,e)),t=n.nextNode();for(;!e.collapsed&&t!=null;){if(t!==e.startContainer&&e.setStart(t,0),t.textContent.length>e.startOffset&&!t.textContent[e.startOffset].match(/\s/))return;try{e.setStart(t,e.startOffset+1)}catch(u){t=n.nextNode(),t==null?e.collapse():e.setStart(t,0)}}},_=(e,n)=>{if(n!=null&&!n.intersectsNode(e))return NodeFilter.FILTER_REJECT;let t=e;for(;t!=null&&!(t instanceof HTMLElement);)t=t.parentNode;if(t!=null){let u=window.getComputedStyle(t);if(u.visibility==="hidden"||u.display==="none"||u.height===0||u.width===0||u.opacity===0)return NodeFilter.FILTER_REJECT}return NodeFilter.FILTER_ACCEPT},Q=(e,n)=>{let t=[],u=[],r=Array.from(ee(e,s=>_(s,n)));for(let s of r)s.nodeType===Node.TEXT_NODE?u.push(s):s instanceof HTMLElement&&L.includes(s.tagName)&&u.length>0&&(t.push(u),u=[]);return u.length>0&&t.push(u),t},Z=(e,n,t)=>{let u="";return e.length===1?u=e[0].textContent.substring(n,t):u=e[0].textContent.substring(n)+e.slice(1,-1).reduce((r,s)=>r+s.textContent,"")+e.slice(-1)[0].textContent.substring(0,t),u.replace(/[\t\n\r ]+/g," ")};function*ee(e,n){let t=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,{acceptNode:n}),u;for(;u=t.nextNode();)yield u}var g=(e,n)=>{let t=Q(n.commonAncestorContainer,n);for(let u of t){let r=te(e,n,u);if(r!==void 0)return r}},te=(e,n,t)=>{if(!e||!n||!(t||[]).length)return;let u=h(Z(t,0,void 0)),r=h(e),s=t[0]===n.startNode?n.startOffset:0,i,a;for(;s<u.length;){let c=u.indexOf(r,s);if(c===-1)return;if(ne(u,c,r.length)&&(i=U(c,t,!1),a=U(c+r.length,t,!0)),i!=null&&a!=null){let o=document.createRange();if(o.setStart(i.node,i.offset),o.setEnd(a.node,a.offset),n.compareBoundaryPoints(Range.START_TO_START,o)<=0&&n.compareBoundaryPoints(Range.END_TO_END,o)>=0)return o}s=c+1}},U=(e,n,t)=>{let u=0,r;for(let s=0;s<n.length;s++){let i=n[s];r||(r=h(i.data));let a=u+r.length;if(t&&(a+=1),a>e){let c=e-u,o=Math.min(e-u,i.data.length),f=t?r.substring(0,c):r.substring(c),d=h(t?i.data.substring(0,o):i.data.substring(o)),D=(t?-1:1)*(f.length>d.length?-1:1);for(;o>=0&&o<=i.data.length;){if(d.length===f.length)return{node:i,offset:o};o+=D,d=h(t?i.data.substring(0,o):i.data.substring(o))}}if(u+=r.length,s+1<n.length){let c=h(n[s+1].data);r.slice(-1)===" "&&c.slice(0,1)===" "&&(u-=1),r=c}}},ne=(e,n,t)=>!(n<0||n>=e.length||t<=0||n+t>e.length||e[n].match(C)&&(++n,--t,!t)||e[n+t-1].match(C)&&(--t,!t)||n!==0&&!e[n-1].match(C)||n+t!==e.length&&!e[n+t].match(C)),h=e=>(e||"").normalize("NFKD").replace(/\s+/g," ").toLowerCase(),l={BLOCK_ELEMENTS:L,BOUNDARY_CHARS:C,NON_BOUNDARY_CHARS:j,filterFunction:_,normalizeString:h};typeof goog!="undefined"&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.textFragmentUtils");var ue=300,re=3,se=1e4,ie=500,k=500,P,ae=e=>{k=e};exports.setTimeout=ae;var E={SUCCESS:0,INVALID_SELECTION:1,AMBIGUOUS:2,TIMEOUT:3};exports.GenerateFragmentStatus=E;var w=(e,n=Date.now())=>{try{return X(e,n)}catch(t){return{status:E.TIMEOUT}}};exports.generateFragment=w;var oe=e=>{if(!e.toString().substring(0,se).match(l.NON_BOUNDARY_CHARS))return!1;try{if(e.startContainer.ownerDocument.defaultView!==window.top)return!1}catch{return!1}let n=e.commonAncestorContainer,t=0;for(;n;){if(n.nodeType==Node.ELEMENT_NODE){if(["TEXTAREA","INPUT"].includes(n.tagName))return!1;let u=n.attributes.getNamedItem("contenteditable");if(u&&u.value!=="false"||(t++,t>=ie))return!1}n=n.parentNode}return!0};exports.isValidRangeForFragmentGeneration=oe;var X=(e,n)=>{v(n);let t;try{t=e.getRangeAt(0)}catch{return{status:E.INVALID_SELECTION}}if(z(t),V(t),t.collapsed)return{status:E.INVALID_SELECTION};let u,r=l.normalizeString(t.toString());if(fe(t)){let f={textStart:r};if(W(f))return{status:E.SUCCESS,fragment:f};u=new T().setExactTextMatch(r)}else{let f=b(t),d=I(t);f&&d?u=new T().setStartAndEndSearchSpace(f,d):u=new T().setSharedSearchSpace(t.toString().trim())}let i=document.createRange();i.selectNodeContents(document.body);let a=i.cloneRange();i.setEnd(t.startContainer,t.startOffset),a.setStart(t.endContainer,t.endOffset);let c=I(i),o=b(a);for((c||o)&&u.setPrefixAndSuffixSearchSpace(c,o);u.embiggen();){let f=u.tryToMakeUniqueFragment();if(f!=null)return{status:E.SUCCESS,fragment:f};A()}return{status:E.AMBIGUOUS}},A=()=>{let e=Date.now()-P;if(e>k){let n=new Error(`Fragment generation timed out after ${e} ms.`);throw n.isTimeout=!0,n}},v=e=>{P=e},b=e=>{let n=Y(e),t=p(n,e.endContainer);if(!t)return;let u=m(t),r=n,s=e.cloneRange();for(;!s.collapsed&&n!=null;){if(A(),n.contains(r)?s.setStartAfter(n):s.setStartBefore(n),S(n)){let i=e.cloneRange();i.setEnd(s.startContainer,s.startOffset);let a=i.toString().trim();if(a.length>0)return a}n=N(t,u)}},I=e=>{let n=ce(e),t=p(n,e.startContainer);if(!t)return;let u=new Set,r=n,s=e.cloneRange();for(;!s.collapsed&&n!=null;){if(A(),n.contains(r)?s.setEnd(n,0):s.setEndAfter(n),S(n)){let i=e.cloneRange();i.setStart(s.endContainer,s.endOffset);let a=i.toString().trim();if(a.length>0)return a}n=B(t,u,r)}},T=class{constructor(){this.Mode={ALL_PARTS:1,SHARED_START_AND_END:2,CONTEXT_ONLY:3},this.startOffset=null,this.endOffset=null,this.prefixOffset=null,this.suffixOffset=null,this.prefixSearchSpace="",this.backwardsPrefixSearchSpace="",this.suffixSearchSpace="",this.numIterations=0}tryToMakeUniqueFragment(){let e;if(this.mode===this.Mode.CONTEXT_ONLY?e={textStart:this.exactTextMatch}:e={textStart:this.getStartSearchSpace().substring(0,this.startOffset).trim(),textEnd:this.getEndSearchSpace().substring(this.endOffset).trim()},this.prefixOffset!=null){let n=this.getPrefixSearchSpace().substring(this.prefixOffset).trim();n&&(e.prefix=n)}if(this.suffixOffset!=null){let n=this.getSuffixSearchSpace().substring(0,this.suffixOffset).trim();n&&(e.suffix=n)}return W(e)?e:void 0}embiggen(){let e=!0;this.mode===this.Mode.SHARED_START_AND_END?this.startOffset>=this.endOffset&&(e=!1):this.mode===this.Mode.ALL_PARTS?this.startOffset===this.getStartSearchSpace().length&&this.backwardsEndOffset()===this.getEndSearchSpace().length&&(e=!1):this.mode===this.Mode.CONTEXT_ONLY&&(e=!1);let n=!1;if((!e||this.numIterations>=re)&&(this.backwardsPrefixOffset()!=null&&this.backwardsPrefixOffset()!==this.getPrefixSearchSpace().length||this.suffixOffset!=null&&this.suffixOffset!==this.getSuffixSearchSpace().length)&&(n=!0),e){if(this.startOffset<this.getStartSearchSpace().length){let t=this.getStartSearchSpace().substring(this.startOffset+1).search(l.BOUNDARY_CHARS);t===-1?this.startOffset=this.getStartSearchSpace().length:this.startOffset=this.startOffset+1+t,this.mode===this.Mode.SHARED_START_AND_END&&(this.startOffset=Math.min(this.startOffset,this.endOffset))}if(this.backwardsEndOffset()<this.getEndSearchSpace().length){let t=this.getBackwardsEndSearchSpace().substring(this.backwardsEndOffset()+1).search(l.BOUNDARY_CHARS);t===-1?this.setBackwardsEndOffset(this.getEndSearchSpace().length):this.setBackwardsEndOffset(this.backwardsEndOffset()+1+t),this.mode===this.Mode.SHARED_START_AND_END&&(this.endOffset=Math.max(this.startOffset,this.endOffset))}}if(n){if(this.backwardsPrefixOffset()<this.getPrefixSearchSpace().length){let t=this.getBackwardsPrefixSearchSpace().substring(this.backwardsPrefixOffset()+1).search(l.BOUNDARY_CHARS);t===-1?this.setBackwardsPrefixOffset(this.getBackwardsPrefixSearchSpace().length):this.setBackwardsPrefixOffset(this.backwardsPrefixOffset()+1+t)}if(this.suffixOffset<this.getSuffixSearchSpace().length){let t=this.getSuffixSearchSpace().substring(this.suffixOffset+1).search(l.BOUNDARY_CHARS);t===-1?this.suffixOffset=this.getSuffixSearchSpace().length:this.suffixOffset=this.suffixOffset+1+t}}return this.numIterations++,e||n}setStartAndEndSearchSpace(e,n){return this.startSearchSpace=e,this.endSearchSpace=n,this.backwardsEndSearchSpace=x(n),this.startOffset=0,this.endOffset=n.length,this.mode=this.Mode.ALL_PARTS,this}setSharedSearchSpace(e){return this.sharedSearchSpace=e,this.backwardsSharedSearchSpace=x(e),this.startOffset=0,this.endOffset=e.length,this.mode=this.Mode.SHARED_START_AND_END,this}setExactTextMatch(e){return this.exactTextMatch=e,this.mode=this.Mode.CONTEXT_ONLY,this}setPrefixAndSuffixSearchSpace(e,n){return e&&(this.prefixSearchSpace=e,this.backwardsPrefixSearchSpace=x(e),this.prefixOffset=e.length),n&&(this.suffixSearchSpace=n,this.suffixOffset=0),this}getStartSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.startSearchSpace}getEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.sharedSearchSpace:this.endSearchSpace}getBackwardsEndSearchSpace(){return this.mode===this.Mode.SHARED_START_AND_END?this.backwardsSharedSearchSpace:this.backwardsEndSearchSpace}getPrefixSearchSpace(){return this.prefixSearchSpace}getBackwardsPrefixSearchSpace(){return this.backwardsPrefixSearchSpace}getSuffixSearchSpace(){return this.suffixSearchSpace}backwardsEndOffset(){return this.getEndSearchSpace().length-this.endOffset}setBackwardsEndOffset(e){this.endOffset=this.getEndSearchSpace().length-e}backwardsPrefixOffset(){return this.prefixOffset==null?null:this.getPrefixSearchSpace().length-this.prefixOffset}setBackwardsPrefixOffset(e){this.prefixOffset!=null&&(this.prefixOffset=this.getPrefixSearchSpace().length-e)}},W=e=>J(e).length===1,x=e=>[...e||""].reverse().join(""),fe=e=>e.toString().length>ue?!1:!G(e),Y=e=>{let n=e.startContainer;return n.nodeType==Node.ELEMENT_NODE&&e.startOffset<n.childNodes.length&&(n=n.childNodes[e.startOffset]),n},ce=e=>{let n=e.endContainer;return n.nodeType==Node.ELEMENT_NODE&&e.endOffset>0&&(n=n.childNodes[e.endOffset-1]),n},G=e=>{let n=e.cloneRange(),t=Y(n),u=p(t);if(!u)return!1;let r=m(u);for(;!n.collapsed&&t!=null;){if(S(t))return!0;t!=null&&n.setStartAfter(t),t=N(u,r),A()}return!1},M=(e,n)=>{if(e.nodeType!==Node.TEXT_NODE)return-1;let t=n??e.data.length;if(t<e.data.length&&l.BOUNDARY_CHARS.test(e.data[t]))return t;let u=e.data.substring(0,t),r=x(u).search(l.BOUNDARY_CHARS);return r!==-1?t-r:-1},$=(e,n)=>{if(e.nodeType!==Node.TEXT_NODE)return-1;let t=n??0;if(t<e.data.length&&t>0&&l.BOUNDARY_CHARS.test(e.data[t-1]))return t;let r=e.data.substring(t).search(l.BOUNDARY_CHARS);return r!==-1?t+r:-1},p=(e,n)=>{if(!e)return;let t=e,u=n??e;for(;!t.contains(u)||!S(t);)t.parentNode&&(t=t.parentNode);let r=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT,s=>l.filterFunction(s));return r.currentNode=e,r},z=e=>{let n=M(e.startContainer,e.startOffset);if(n!==-1){e.setStart(e.startContainer,n);return}if(S(e.startContainer)&&e.startOffset===0)return;let t=p(e.startContainer);if(!t)return;let u=new Set,r=t.currentNode,s=B(t,u,r);for(;s!=null;){let i=M(s);if(i!==-1){e.setStart(s,i);return}if(S(s)){s.contains(e.startContainer)?e.setStart(s,0):e.setStartAfter(s);return}s=B(t,u,r)}e.collapse()},m=e=>{let n=e.currentNode,t=new Set,u=new Map;do{let r=e.currentNode;for(t.add(r);e.lastChild()!=null&&!t.has(e.currentNode););let s=u.get(e.currentNode);e.currentNode!==r&&u.set(e.currentNode,r),u.set(r,s||e.nextNode()),e.currentNode=r}while(e.parentNode()!=null);return e.currentNode=n,u},N=(e,n)=>{if(n.has(e.currentNode)){let t=n.get(e.currentNode);return t!=null&&(e.currentNode=t),t}return e.nextNode()},B=(e,n,t)=>{for(;;){if(A(),!n.has(e.currentNode)&&!e.currentNode.contains(t)&&(n.add(e.currentNode),e.lastChild()!=null)||e.previousSibling()!=null)return e.currentNode;if(e.parentNode()==null)return null;if(!n.has(e.currentNode))return e.currentNode}},V=e=>{let n=e.endOffset,t=e.endContainer;t.nodeType===Node.ELEMENT_NODE&&e.endOffset<t.childNodes.length&&(t=t.childNodes[e.endOffset]);let u=p(t);if(!u)return;let r=m(u);for(;t!=null;){A();let s=$(t,n);if(n=null,s!==-1){e.setEnd(t,s);return}if(S(t)){t.contains(e.endContainer)?e.setEnd(t,t.childNodes.length):e.setEndBefore(t);return}t=N(u,r)}e.collapse()},S=e=>e.nodeType===Node.ELEMENT_NODE&&(l.BLOCK_ELEMENTS.includes(e.tagName)||e.tagName==="HTML"||e.tagName==="BODY"),de={backwardTraverse:B,containsBlockBoundary:G,createForwardOverrideMap:m,doGenerateFragment:X,expandRangeEndToWordBound:V,expandRangeStartToWordBound:z,findWordEndBoundInTextNode:$,findWordStartBoundInTextNode:M,forwardTraverse:N,FragmentFactory:T,getSearchSpaceForEnd:I,getSearchSpaceForStart:b,recordStartTime:v};exports.forTesting=de;typeof goog!="undefined"&&goog.declareModuleId("googleChromeLabs.textFragmentPolyfill.fragmentGenerationUtils");(e=>{let n=!0,t=(...a)=>{n&&console.log(...a)},u=a=>{let c=window.getSelection(),o=w(c),f=`${location.origin}${location.pathname}${location.search}`;if(o.status===0){let d=o.fragment,D=d.prefix?`${encodeURIComponent(d.prefix)}-,`:"",R=d.suffix?`,-${encodeURIComponent(d.suffix)}`:"",K=encodeURIComponent(d.textStart),q=d.textEnd?`,${encodeURIComponent(d.textEnd)}`:"";f=`${f}#:~:text=${D}${K}${q}${R}`,i(f,c.toString()),r()}else s()},r=()=>{let a=document.createElement("style");document.head.append(a),a.sheet.insertRule(" ::selection { color: #000 !important; background-color: #ffff00 !important; }");let o=window.getSelection(),f=o.getRangeAt(0);return o.removeAllRanges(),window.setTimeout(()=>o.addRange(f),0),window.setTimeout(()=>a.remove(),2e3),!0},s=()=>(window.queueMicrotask(()=>{}),!0),i=(a,c)=>{e.storage.sync.get({linkStyle:"rich"},async o=>{let f=o.linkStyle;try{let{state:d}=await navigator.permissions.query({name:"clipboard-write"});if(d!=="granted")throw new Error("Clipboard permission not granted");let D={"text/plain":new Blob([a],{type:"text/plain"})};f==="rich"&&(D["text/html"]=new Blob([`<a href="${a}">${c}</a>`],{type:"text/html"}));let R=[new ClipboardItem(D)];await navigator.clipboard.write(R)}catch(d){console.warn(d.name,d.message);let D=document.createElement("textarea");document.body.append(D),D.textContent=a,D.select(),document.execCommand("copy"),D.remove()}return t("\u{1F389}",a),!0})};e.runtime.onMessage.addListener((a,c,o)=>{let f=a.message;if(f==="create-text-fragment")return o(u());if(f==="debug")return o((n=a.data)||!0);if(f==="ping")return o("pong")})})(chrome||browser);})();
